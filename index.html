<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cargando Reporte de Pruebas...</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; background-color: #f4f4f9; }
        .loader { text-align: center; }
        .spinner { border: 4px solid rgba(0, 0, 0, 0.1); width: 36px; height: 36px; border-radius: 50%; border-left-color: #09f; animation: spin 1s linear infinite; margin: 0 auto 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="loader">
        <div class="spinner"></div>
        <p id="status">Buscando el último reporte de ejecución...</p>
    </div>

    <script>
        // CONFIGURACIÓN DE TU REPOSITORIO
        const USER = "josegonzales22";
        const REPO = "selenium-axe-core";
        const FOLDER = "reports";

        async function buscarUltimoReporte() {
            const statusText = document.getElementById('status');
            try {
                // Consultar la API de GitHub para listar archivos de la carpeta reports
                const response = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${FOLDER}`);
                
                if (!response.ok) throw new Error("No se pudo acceder a la carpeta de reportes.");

                const files = await response.json();

                // Filtrar archivos que empiecen con "ExecutionReport_" y terminen en ".html"
                const reportes = files.filter(file => 
                    file.name.startsWith("ExecutionReport_") && file.name.endsWith(".html")
                );

                if (reportes.length === 0) {
                    statusText.innerText = "No se encontraron reportes en la carpeta.";
                    return;
                }

                // Ordenar por nombre (alfabéticamente descendente) para obtener el timestamp más reciente
                reportes.sort((a, b) => b.name.localeCompare(a.name));

                const ultimoReporte = reportes[0];
                
                statusText.innerText = "Reporte encontrado. Redirigiendo...";
                
                // Redirigir a la ruta del archivo encontrado
                window.location.href = ultimoReporte.path;

            } catch (error) {
                console.error(error);
                statusText.innerHTML = `Error: ${error.message}<br><small>Verifica que el repo sea público y el nombre de la carpeta sea correcto.</small>`;
            }
        }

        // Ejecutar la búsqueda al cargar la página
        buscarUltimoReporte();
    </script>
</body>
</html>